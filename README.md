# SKN01-3nd-5Team

![header](https://capsule-render.vercel.app/api?type=venom&color=FC4D01&text=SKN01-3nd-5Team&height=300&fontSize=90&&fontColor=FFFFFF)

SKN01-3nd-5Team

# 1. Introduction Team (íŒ€ ì†Œê°œ)
- ### ğŸ¥”Chat-gtp(great-taking-potato)ğŸ¥”

| ê¹€ìš©í˜„ | ê¹€ì§€ë¯¼ | í•œë³‘ì°¬ | ì´ìš©ìš° | ì •ì›í˜•|
|:----------:|:----------:|:----------:|:----------:|:----------:|
| <img width="120px" src="https://github.com/Jh-jaehyuk/Jh-jaehyuk.github.io/assets/126551524/33ea2a85-1853-484b-b2a4-c750f854a26b" /> | <img width="120px" src="https://github.com/user-attachments/assets/628ab454-d1b8-41d3-88fc-a013ade00cb7" /> | <img width="120px" src="https://github.com/younghyen7956/study/assets/155882166/cd405d10-d646-4ba8-bda8-051f24d1bf30" /> |  <img width="120px" src="https://github.com/younghyen7956/study/assets/155882166/68939030-b840-4e41-8970-afe6cdbce4d5" /> | <img width="120px" src="https://github.com/user-attachments/assets/2c462581-5fae-46a3-b314-d09dfde4dd0d" /> |
| [@younghyen7956](https://github.com/younghyen7956) | [@jimin9703](https://github.com/jimin9703) | [@onebottlekick](https://github.com/onebottlekick) | [@lyw00](https://github.com/lyw00) | [@wh5905](https://github.com/wh5905) |
# 2. Introduction Project (í”„ë¡œì íŠ¸ ê°œìš”)

# CI/CD í”„ë¡œì íŠ¸ ê°œìš”

**CI/CD**ëŠ” "Continuous Integration"ê³¼ "Continuous Deployment"ì˜ ì•½ìë¡œ, ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë° ë°°í¬ì˜ íš¨ìœ¨ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ìë™í™”ëœ í”„ë¡œì„¸ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. CI/CDëŠ” ê°œë°œìê°€ ì½”ë“œë¥¼ ì§€ì†ì ìœ¼ë¡œ í†µí•©í•˜ê³ , ì´ë¥¼ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë° ë°°í¬í•˜ì—¬ ì‹ ì†í•˜ê³  ì•ˆì •ì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ì œê³µì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

## âœ…í”„ë¡œì íŠ¸ ì†Œê°œ
ì´ **CI/CD í”„ë¡œì íŠ¸**ëŠ” ê°œë°œíŒ€ì˜ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ë¼ì´í”„ì‚¬ì´í´ì„ ìë™í™”í•˜ê³  ìµœì í™”í•˜ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. CI/CD íŒŒì´í”„ë¼ì¸ì€ ì½”ë“œì˜ ë³€ê²½ ì‚¬í•­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•˜ê³ , ì´ë¥¼ ìë™ìœ¼ë¡œ ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ë°°í¬í•˜ëŠ” ì¼ë ¨ì˜ ìë™í™”ëœ í”„ë¡œì„¸ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¤ì–‘í•œ ë„êµ¬ì™€ í”Œë«í¼(ì˜ˆ: Jenkins, GitLab CI, GitHub Actions, CircleCI ë“±)ì„ í™œìš©í•˜ì—¬ íš¨ê³¼ì ì¸ CI/CD í™˜ê²½ì„ êµ¬ì¶•í•˜ê³ , ê°œë°œíŒ€ì˜ ìƒì‚°ì„±ì„ ê·¹ëŒ€í™”í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

## âœ…í•„ìš”ì„±

1. **íš¨ìœ¨ì ì¸ ì½”ë“œ í†µí•©**: ê°œë°œìë“¤ì´ ì½”ë“œ ë³€ê²½ ì‚¬í•­ì„ ìì£¼ í†µí•©í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ì½”ë“œì˜ ì¶©ëŒì„ ì‚¬ì „ì— ì˜ˆë°©í•˜ê³ , ì½”ë“œ í’ˆì§ˆì„ ìœ ì§€í•©ë‹ˆë‹¤.
2. **ë¹ ë¥¸ í”¼ë“œë°± ë£¨í”„**: ìë™í™”ëœ í…ŒìŠ¤íŠ¸ì™€ ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ë¥¼ í†µí•´ ì½”ë“œ ë³€ê²½ í›„ ì‹ ì†í•˜ê²Œ í”¼ë“œë°±ì„ ì œê³µí•¨ìœ¼ë¡œì¨ ë²„ê·¸ë¥¼ ì¡°ê¸°ì— ë°œê²¬í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **ë°°í¬ì˜ ìë™í™”**: ë°°í¬ ê³¼ì •ì„ ìë™í™”í•˜ì—¬ ë°°í¬ì˜ ì¼ê´€ì„±ì„ ë†’ì´ê³ , ìˆ˜ë™ ì˜¤ë¥˜ë¥¼ ì¤„ì´ë©°, ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ë‚˜ ë²„ê·¸ ìˆ˜ì •ì„ ì‹ ì†í•˜ê²Œ ì‚¬ìš©ìì—ê²Œ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. **ë¹„ì¦ˆë‹ˆìŠ¤ ë¯¼ì²©ì„± í–¥ìƒ**: CI/CDë¥¼ í†µí•´ ê°œë°œ ì£¼ê¸°ë¥¼ ë‹¨ì¶•ì‹œí‚¤ê³ , ì‹œì¥ì˜ ìš”êµ¬ì— ë¹ ë¥´ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## âœ…ëª©í‘œ

1. **ìë™í™”ëœ í…ŒìŠ¤íŠ¸ ë° ë¹Œë“œ**: ì½”ë“œê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³ , ì„±ê³µì ì¸ ê²½ìš°ì—ë§Œ ë¹Œë“œë¥¼ ì§„í–‰í•˜ì—¬ ì•ˆì •ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.
2. **ì§€ì†ì ì¸ ë°°í¬**: ì„±ê³µì ì¸ ë¹Œë“œ í›„ ìë™ìœ¼ë¡œ ë°°í¬ë¥¼ ì§„í–‰í•˜ì—¬ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‹ ì†í•˜ê²Œ ì‚¬ìš©ìì—ê²Œ ì œê³µí•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
3. **í†µí•© í™˜ê²½ ì œê³µ**: ë‹¤ì–‘í•œ ê°œë°œ ë° ë°°í¬ ë„êµ¬ë¥¼ í†µí•©í•˜ì—¬ ì¼ê´€ëœ CI/CD í™˜ê²½ì„ êµ¬ì¶•í•˜ê³ , ê°œë°œíŒ€ ê°„ì˜ í˜‘ì—…ì„ ì´‰ì§„í•©ë‹ˆë‹¤.
4. **ë¬¸ì„œí™” ë° ëª¨ë‹ˆí„°ë§**: CI/CD íŒŒì´í”„ë¼ì¸ì˜ ê° ë‹¨ê³„ë¥¼ ë¬¸ì„œí™”í•˜ê³ , ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì—¬ ë¬¸ì œë¥¼ ì¡°ê¸°ì— ë°œê²¬í•˜ê³  í•´ê²°í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
5. **ë³€ê²½ ì‚¬í•­ì˜ íˆ¬ëª…ì„± ì œê³µ**: CI/CD íŒŒì´í”„ë¼ì¸ì„ í†µí•´ ì½”ë“œ ë³€ê²½ ì‚¬í•­ê³¼ ë°°í¬ ìƒíƒœë¥¼ ëª…í™•í•˜ê²Œ ê´€ë¦¬í•˜ê³ , íŒ€ì›ë“¤ê³¼ ì´í•´ê´€ê³„ìë“¤ì—ê²Œ íˆ¬ëª…í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ì´ í”„ë¡œì íŠ¸ëŠ” CI/CD í”„ë¡œì„¸ìŠ¤ë¥¼ í†µí•´ ê°œë°œì˜ íš¨ìœ¨ì„±ê³¼ í’ˆì§ˆì„ ë†’ì´ê³ , ê³ ê°ì—ê²Œ ë” ë‚˜ì€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì œê³µí•˜ê¸° ìœ„í•œ í•„ìˆ˜ì ì¸ ê¸°ë°˜ì„ ë§ˆë ¨í•˜ëŠ” ë° ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤.


# 3. ERD êµ¬ì„±
<div style="text-align: center;">
  <img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-1st-5Team/assets/168423037/0c38f744-c977-4807-a6d2-92ff0b68b68c" alt="img">
</div>

## ì• ìì¼ ë³´ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 
```c
ê³¼ê±° ì •ì˜ì„œë“¤ì„ ì¼ì¼íˆ ì‘ì„±í•˜ì˜€ì§€ë§Œ ë¹ ë¥¸ ì†ë„ë¡œ ë¬´ì–¸ê°€ë¥¼ ê°œë°œí•˜ëŠ”ë° í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.
ì²˜ìŒë¶€í„° ë§ì€ ê²ƒë“¤ì„ ë¹Œë“œì—…í•˜ë©´ì„œ ë¹ ë¥¸ ìƒì‚°ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ì›€ì§ì´ë ¤ë©´ ë°˜ë“œì‹œ ì• ìì¼í•´ì•¼í•©ë‹ˆë‹¤.
ê³ ë¡œ í­í¬ìˆ˜ ì„¤ê³„ ë°©ì‹ì´ ì•„ë‹Œ ì• ìì¼ í”„ë¡œì„¸ìŠ¤ ë°©ì‹ìœ¼ë¡œ ì• ìì¼ ë³´ë“œë¥¼ ì‘ì„±í•˜ë©´ì„œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

ì• ìì¼ ë³´ë“œëŠ” ìì²´ì ìœ¼ë¡œ ì œëª©ì´ ìš”êµ¬ ì‚¬í•­ì„ ë‚´í¬í•˜ë©° ê° ì¹´ë“œ ë‚´ë¶€ì—ëŠ” ì •ì˜í•œ Domainì˜ ì„¸ë¶€ ì‚¬í•­ì´ ê¸°ë¡ë©ë‹ˆë‹¤.
ê³ ë¡œ ë¹ ë¥´ê²Œ íŒ€ì›ë“¤ê³¼ í˜‘ì—… í•  ìˆ˜ ìˆê³  ì†Œí†µ ë¹„ìš©ì„ ìµœì†Œí™”ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì‘ì€ ê²ƒ ê°™ì§€ë§Œ ì´ì™€ ê°™ì€ ê²ƒë“¤ì´ ìŒ“ì—¬ì„œ ì•„ì£¼ ê¸°ë¯¼í•˜ê³  ë¯¼ì²©í•œ ì¡°ì§ì„ ë§Œë“¤ì–´ ëƒ…ë‹ˆë‹¤.
```

# 4. Backend ì• ìì¼ ë³´ë“œ - ìš”êµ¬ ì‚¬í•­ ì •ì˜ì„œ
### â¡ï¸Backend
![backend](https://github.com/user-attachments/assets/c5bc9c8f-b6de-4194-b8d9-0b97e5345ed7)

# 5. Frontend ì• ìì¼ ë³´ë“œ - í™”ë©´ ì„¤ê³„ì„œ
### â¡ï¸Frontend
![frontend1](https://github.com/user-attachments/assets/4294699e-0223-493f-8295-a673a4a79660)
![frontend2](https://github.com/user-attachments/assets/dc54b20e-e5a7-4772-aca5-e4fc5ebc40f3)
# 6. FastAPI ì• ìì¼ ë³´ë“œ - AI ì„œë¹™ ì„¤ê³„ì„œ

# 7. ì‹œìŠ¤í…œ êµ¬ì„±ë„
![image](https://github.com/user-attachments/assets/5385f5b5-fbd1-41b9-bbec-eea1a607c67b)

# 8. Manual Deploy (ìˆ˜ë™ ë°°í¬ ì§„í–‰ ì ˆì°¨)

## Frontend (UI)
â… localì—ì„œ build 
    
    npm run build

build ê²°ê³¼ ì‚¬ì§„ (ë°‘ì—)

â…¡ scp ëª…ë ¹ì–´ ì‚¬ìš©í•˜ì—¬ aws ì„œë²„ì— buildë¥¼ ì˜¬ë¦¼
    
    scp -i "pemí‚¤(ìƒëŒ€ê²½ë¡œ í˜¹ì€ ì ˆëŒ€ê²½ë¡œ)" -r * ec2-user@AWS_IP:/home/ec2-user/ì´ë¦„/vue-frontend/html/

â…¢ aws ì„œë²„ì— ì ‘ì† í›„
  
    ssh -i "ë³¸ì¸ì˜ pemí‚¤" ec2-user@public ipv4

â…£ docker-compose.yml íŒŒì¼ì„ ì´ìš©í•´
    
    docker-compose up -d

ì‹¤í–‰í•˜ì—¬ backgroundì—ì„œ ìˆ˜ë™ ë°°í¬

## Backend (Server)

1. ê¸°ë³¸ì ì¸ ì‘ì—…

        chmod +x wait-for-it.sh
        chmod +x manage.py # íŒŒì¼ì— ëŒ€í•œ ê¶Œí•œ ì„¤ì •
        ssh -i "ë³¸ì¸ì˜ pemí‚¤" ec2-user@public ipv4 #awsì— ë¡œê·¸ì¸

2. localì—ì„œ ìˆ˜ë™ build

       docker buildx create --use
       docker buildx build --platform linux/arm64 -f Dockerfile -t ghcr.io/ê³„ì •/django-test-server:latest --push .
â€‹
3. aws ì„œë²„ ì ‘ì†
  
    ssh -i "ë³¸ì¸ì˜ pemí‚¤" ec2-user@public ipv4

4. awsì— ì ‘ì†í•˜ì—¬ docker-compose.ymlì„ ì´ìš©í•˜ì—¬ ìˆ˜ë™ buildë¥¼ í•©ë‹ˆë‹¤.

       docker-compose up -d


## FastAPI (AI Core Server)
1. dockerì„œë²„ì— ë¡œê·¸ì¸

        echo "GHCRí† í°" | docker login ghcr.io -u ê³„ì • --password-stdin

2. localì—ì„œ build í›„ docker ì„œë²„ì— ì˜¬ë¦½ë‹ˆë‹¤.
  
        export DOCKER_BUILDKIT=1
        docker buildx create --use
        docker buildx build --platform linux/arm64 --file ./Dockerfile --push -t ghcr.io/ê³„ì •/gtp-fastapi-server:latest .

3. 3. docker ì„œë²„ ì ‘ì†
  
    ssh -i "ë³¸ì¸ì˜ pemí‚¤" ec2-user@public ipv4

4. awsì— ì ‘ì†í•˜ì—¬ docker-compose.ymlì„ ì´ìš©í•˜ì—¬ ìˆ˜ë™ buildë¥¼ í•©ë‹ˆë‹¤.

       docker-compose up -d

# 9. Autonomous Deploy (ìë™ ë°°í¬ ì§„í–‰ ì ˆì°¨)

## Frontend (UI)
 ğŸ‘‡ CI.yml
 
    name: CI (Continuous Integration)
  
    on:
      push:
        branches: ["main"]
    
    jobs:
      build:
        name: Frontend CI
        runs-on: ubuntu-latest
        steps:
          - name: Checkout repository
            uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '20'

      - name: Cache dependencies
        id: cache
        uses: actions/cache@v3
        with:
          path: '**/node_modules'
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: Install Dependencies
        if: steps.cache.outputs.cache-hit != 'true'
        run: |
          npm ci --legacy-peer-deps

      - name: Create .env development for CI
        run: |
          pwd
          echo "${{ secrets.ENV_DEVELOPMENT }}" > .env.development
          cat .env.development

      - name: Real Test
        run: |
          npm run test:unit

      - name: send FRONTEND_TEST_FINISH_TRIGGER
        run: |
          curl -S -X POST https://api.github.com/repos/${{ github.repository }}/dispatches \
                -H 'Accept: application/vnd.github.v3+json' \
                -u ${{ secrets.GHCR_TOKEN }} \
                -d '{"event_type": "FRONTEND_TEST_FINISH_TRIGGER", "client_payload": {"repository": "'"$GITHUB_REPOSITORY"'" }}'

ğŸ‘‡ CD.yml

    name: CD (Continuous Deploy)
  
    on:
      repository_dispatch:
        types: [FRONTEND_TEST_FINISH_TRIGGER]
    
    jobs:
      build:
        name: build-app
        runs-on: ubuntu-latest
        steps:
        - name: Get Github Actions IP
          id: ip
          uses: haythem/public-ip@v1.2

    - name: Configure AWS IAM Credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ap-northeast-2

    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Setup node.js
      uses: actions/setup-node@v2
      with:
        node-version: '20'

    - name: Cache dependencies
      id: cache
      uses: actions/cache@v3
      with:
        path: '**/node_modules'
        key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
        restore-keys: |
          ${{ runner.os }}-node-

    - name: Install Dependencies
      if: steps.cache.outputs.cache-hit != 'true'
      run: |
        npm ci --legacy-peer-deps

    - name: Create .env.production for Continuous Deploy
      run: |
        echo "${{ secrets.ENV_PRODUCTION }}" > .env.production
        cat .env.production

    - name: Build
      run: |
        npm run build
        ls

    - name: Setup SSH
      uses: webfactory/ssh-agent@v0.5.0
      with:
        ssh-private-key: ${{ secrets.PRIVATE_KEY }}

    - name: Add Github Actions IP to Security Group
      run: |
        aws ec2 authorize-security-group-ingress --group-id ${{ secrets.AWS_SG_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32

    - name: SCP Action
      uses: appleboy/scp-action@master
      with:
        host: ${{ secrets.HOST_IP }}
        username: ec2-user
        key: ${{ secrets.PRIVATE_KEY }}
        source: "./dist/**"
        target: "/home/ec2-user/gtp/actions-frontend"

    - name: Remove Github Actions IP From Security Group
      run: |
        aws ec2 revoke-security-group-ingress --group-id ${{ secrets.AWS_SG_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32

    - name: SSH Agent Cleanup
      if: ${{ always() }}
      uses: webfactory/ssh-agent@v0.5.0
      with:
        ssh-private-key: ${{ secrets.PRIVATE_KEY }}

    deploy:
      name: Deploy to Production
      needs: build
      runs-on: [ self-hosted, deploy-gtp-frontend ]
      steps:
        - name: Get Github Actions IP
          id: ip
          uses: haythem/public-ip@v1.2
        
      - name: Configure AWS IAM Credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ap-northeast-2

      - name: Add Github Actions IP to Security Group
        run: |
          aws ec2 authorize-security-group-ingress --group-id ${{ secrets.AWS_SG_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32
    
      - name: Deploy to Production
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.HOST_IP }}
          username: ec2-user
          key: ${{ secrets.PRIVATE_KEY }}
          script_stop: true
          script: |
            pwd
            cd /home/ec2-user/gtp/vue-frontend
            cp -r /home/ec2-user/gtp/actions-frontend/dist/* ./html/

            docker image prune -f
            docker logout

            docker-compose up -d

      - name: Remove Github Actions IP From Security Group
        run: |
          aws ec2 revoke-security-group-ingress --group-id ${{ secrets.AWS_SG_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32

## Backend (Server)
  ğŸ‘‡ CI.yml
    
    name: Django CI (Continuous Integration)
  
    on:
      push:
        branches: ["main"]
    
    jobs:
      build:
        runs-on: ubuntu-latest

    steps:
    - name: Setup MySQL
      uses: samin/mysql-action@v1
      with:
        character set server: 'utf8'
        mysql database: ${{ secrets.DATABASE_NAME }}
        mysql user: ${{ secrets.DATABASE_USER }}
        mysql password: ${{ secrets.DATABASE_PASSWORD }}

    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.12.3

    - name: Check current directory
      run: pwd

    - name: List files in current directory
      run: ls -la

    - name: Cache pip
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: Install Dependencies
      working-directory: ./gtp_backend
      run: |
        if [ -f requirements.txt ]; then
          python -m venv .venv
          source .venv/bin/activate
          pip install --upgrade pip
          pip install -r requirements.txt
        else
          echo "requirements.txt not found"
          exit 1
        fi

    - name: Create .env file for CI
      working-directory: ./gtp_backend
      run: |
        echo "CORS_ALLOWED_ORIGINS=${{ secrets.CORS_ALLOWED_ORIGINS }}" > .env
        echo "CSRF_TRUSTED_ORIGINS=${{ secrets.CSRF_TRUSTED_ORIGINS }}" >> .env
        echo "DATABASE_NAME=${{ secrets.DATABASE_NAME }}" >> .env
        echo "DATABASE_USER=${{ secrets.DATABASE_USER }}" >> .env
        echo "DATABASE_PASSWORD=${{ secrets.DATABASE_PASSWORD }}" >> .env
        echo "DATABASE_HOST=127.0.0.1" >> .env
        echo "DATABASE_PORT=3306" >> .env
        echo "KAKAO_LOGIN_URL=${{ secrets.KAKAO_LOGIN_URL }}" >> .env
        echo "KAKAO_CLIENT_ID=${{ secrets.KAKAO_CLIENT_ID }}" >> .env
        echo "KAKAO_REDIRECT_URI=${{ secrets.KAKAO_REDIRECT_URI }}" >> .env
        echo "KAKAO_TOKEN_REQUEST_URI=${{ secrets.KAKAO_TOKEN_REQUEST_URI }}" >> .env
        echo "KAKAO_USERINFO_REQUEST_URI=${{ secrets.KAKAO_USERINFO_REQUEST_URI }}" >> .env
        echo "REDIS_HOST=${{ secrets.REDIS_HOST }}" >> .env
        echo "REDIS_PORT=${{ secrets.REDIS_PORT }}" >> .env
        echo "REDIS_PASSWORD=${{ secrets.REDIS_PASSWORD }}" >> .env

    - name: Wait for MySQL to be ready
      working-directory: ./gtp_backend
      run: |
        for i in {60..0}; do
          if mysqladmin ping -h "127.0.0.1" --silent; then
            break
          fi
          echo 'MySQL is unavailable - sleeping'
          sleep 2
        done

        if [ "$i" = 0 ]; then
          echo 'MySQL is still unavailable - exiting'
          exit 1
        fi
        echo 'MySQL is up - continuning'

    - name: Make migrations
      working-directory: ./gtp_backend
      run: |
        source .venv/bin/activate
        python manage.py makemigrations

    - name: Run migrate
      working-directory: ./gtp_backend
      run: |
        source .venv/bin/activate
        python manage.py migrate --noinput

    - name: Find test modules
      working-directory: ./gtp_backend
      run: |
        source .venv/bin/activate
        chmod +x find_test.sh
        TEST_MODULES=$(./find_test.sh)
        echo "TEST_MODULES=$TEST_MODULES" >> $GITHUB_ENV

    - name: Run Tests
      working-directory: ./gtp_backend
      run: |
        source .venv/bin/activate
        python manage.py test $TEST_MODULES

    - name: send BACKEND_TEST_FINISH_TRIGGER
      run: |
        curl -S -X POST https://api.github.com/repos/${{ github.repository }}/dispatches \
            -H 'Accept: application/vnd.github.v3+json' \
            -u ${{ secrets.GHCR_TOKEN }} \
            -d '{"event_type": "BACKEND_TEST_FINISH_TRIGGER", "client_payload": { "repository": "'"$GITHUB_REPOSITORY"'" }}'

ğŸ‘‡ CD.yml

    name: Django CD (Continuous Deploy)
  
    on:
      repository_dispatch:
        types: [BACKEND_TEST_FINISH_TRIGGER]
    
    jobs:
      build:
        name: build-app
        runs-on: ubuntu-latest
        steps:
        - name: Checkout repository
          uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.12.3'

    - name: Cache pip
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: Install dependencies
      working-directory: ./gtp_backend
      run: |
        if [ -f requirements.txt ]; then
          python -m venv .venv
          source .venv/bin/activate
          pip install --upgrade pip
          pip install -r requirements.txt
        else
          echo "requirements.txt not found. Exiting."
          exit 1
        fi

    - name: Grant execute permission for scripts
      run: |
        chmod +x gtp_backend/wait-for-it.sh
        chmod +x gtp_backend/manage.py

    - name: Configure Docker
      uses: docker/setup-buildx-action@v1

    - name: Cache Docker Layers
      uses: actions/cache@v2
      with:
        path: /tmp/.buildx-cache
        key: ${{ runner.os }}-buildx-${{ env.VERSION }}
        restore-keys: |
          ${{ runner.os }}-buildx-

    - name: Set up Docker BuildKit
      run: |
        echo "DOCKER_BUILDKIT=1" >> $GITHUB_ENV

    - name: Login to GHCR
      uses: docker/login-action@v1
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GHCR_TOKEN }}

    - name: Build and push Docker image
      run: |
        cd gtp_backend
        docker buildx build --platform linux/arm64 -f Dockerfile -t ghcr.io/${{ github.actor }}/gtp-django-server:latest --push .

    deploy:
      needs: build
      name: Deploy
      runs-on: [self-hosted, deploy-django]
      steps:
      - name: Get Github Actions IP
        id: ip
        uses: haythem/public-ip@v1.2
      
    - name: Configure AWS IAM Credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ap-northeast-2

    - name: Add Github Actions IP to Security Group
      run: |
        aws ec2 authorize-security-group-ingress --group-id ${{ secrets.AWS_SECURITY_GROUP_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32
          
    - name: Login to GHCR
      uses: docker/login-action@v1
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GHCR_TOKEN }}

    - name: Deploy to production
      uses: appleboy/ssh-action@v0.1.10
      with:
        host: ${{ secrets.HOST_IP }}
        username: ec2-user
        key: ${{ secrets.PRIVATE_KEY }}
        script_stop: true
        script: |
          cd /home/ec2-user/django-backend
          
          docker-compose down
          echo ${{ secrets.GHCR_TOKEN }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin
          
          docker-compose up -d

          docker logout
          docker image prune -f

    - name: Remove Github Actions IP From Security Group
      run: |
        aws ec2 revoke-security-group-ingress --group-id ${{ secrets.AWS_SECURITY_GROUP_ID }} --protocol tcp --port 22 --cidr ${{ steps.ip.outputs.ipv4 }}/32
## FastAPI (AI Core Server)
ğŸ‘‡ main.yml

    name: Deploy to AWS      
    on:
      push:
        branches:
          - main
    
    env:
      DOCKER_IMAGE: ghcr.io/${{github.actor}}/gtp-fastapi-server
      VERSION: ${{github.sha}}
      NAME: fastapi-server
    
    jobs:
      build:
        runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Configure Docker
        uses: docker/setup-buildx-action@v1

      - name: Cache Docker Layers
        uses: actions/cache@v2
        with:
          path: /tmp/.buildx-cache
          key: ${{runner.os}}-buildx-${{env.VERSION}}}
          restore-keys: |
            ${{runner.os}}-buildx-
            
      - name: Set up Docker BuildKit
        run: |
          echo "DOCKER_BUILDKIT=1" >> $GITHUB_ENV

      - name: Login to GHCR
        uses: docker/login-action@v1
        with:
          registry: ghcr.io
          username: ${{github.actor}}
          password: ${{secrets.GHCR_TOKEN}}

      - name: Build and push Docker image
        uses: docker/build-push-action@v2
        with:
          context: .
          file: ./Dockerfile
          push: true
          tags: ghcr.io/${{secrets.REAL_ACTOR}}/gtp-fastapi-server:latest
          platforms: linux/arm64
          
    deploy:
      needs: build
      name: Deploy
      runs-on: [self-hosted, deploy-fastapi]
      steps:
        - name: Login to ghcr
          uses: docker/login-action@v1
          with:
            registry: ghcr.io
            username: ${{github.actor}}
            password: ${{secrets.GHCR_TOKEN}}
          
      - name: Deploy to prod
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{secrets.HOST_PROD}}
          username: ec2-user
          key: ${{secrets.PRIVATE_KEY}}
          script_stop: true
          script: |
            pwd
            ls -al
            cd fastapi/actions-runner
            pwd
  
            echo ${{secrets.GHCR_TOKEN}} | docker login ghcr.io -u ${{github.actor}} --password-stdin
  
            docker pull ghcr.io/${{secrets.REAL_ACTOR}}/gtp-fastapi-server:latest
  
            docker image prune -f
            docker logout
  
            docker-compose up -d

# 10. Result (ìˆ˜í–‰ ê²°ê³¼)
### â¡ï¸ ë©”ì¸ í™”ë©´
<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-1st-5Team/assets/168423037/eadc16be-2c03-401d-b4b9-27ffbb6cd5c9"/>

### â¡ï¸ ê°œì¸ë³„ í˜¸í…” ì¶”ì²œ ì„œë¹„ìŠ¤
<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-2nd-5Team/assets/168423037/0215b44b-b0aa-48be-833d-4a7a5602fd52"/>

### â¡ï¸ AARRR ë¶„ì„ í˜ì´ì§€
<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-2nd-5Team/assets/168423037/ff46ab8d-00bb-4c4a-b875-17162b703ff6"/>
<img src="https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-2nd-5Team/assets/168423037/caa0dc76-b158-4293-b0b7-a70ab87bfb13"/>

# 11. Tech Stack (ê¸°ìˆ  ìŠ¤íƒ)
### Backend
<img src="https://img.shields.io/badge/django-092E20?style=for-the-badge&logo=django&logoColor=white"/> ![Python](https://img.shields.io/badge/python-3776AB?style=for-the-badge&logo=python&logoColor=white) <img src="https://img.shields.io/badge/pandas-%23150458?style=for-the-badge&logo=pandas&logoColor=white"/> <img src="https://img.shields.io/badge/numpy-%23013243?style=for-the-badge&logo=numpy&logoColor=white"/>

### Frontend
<img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white"/> <img src="https://img.shields.io/badge/css-1572B6?style=for-the-badge&logo=css3&logoColor=white"/> <img src="https://img.shields.io/badge/typescript-3178C6?style=for-the-badge&logo=typescript&logoColor=black"/> <img src="https://img.shields.io/badge/vue.js-4FC08D?style=for-the-badge&logo=vue.js&logoColor=white"/> <img src="https://img.shields.io/badge/vuetify-%231867C0?style=for-the-badge&logo=vuetify&logoColor=white"/> <img src="https://img.shields.io/badge/axios-%235A29E4?style=for-the-badge&logo=axios&logoColor=white"/>

### Communication
![Github](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white) <img src="https://img.shields.io/badge/notion-%23000000?style=for-the-badge&logo=notion&logoColor=white"/> <img src="https://img.shields.io/badge/slack-%234A154B?style=for-the-badge&logo=slack&logoColor=white"/> ![GitKraken](https://img.shields.io/badge/GitKraken-179287?style=for-the-badge&logo=gitkraken&logoColor=white) ![Discord](https://img.shields.io/badge/Discord-5865F2?style=for-the-badge&logo=discord&logoColor=white)

### IDE
![Visual Studio Code](https://img.shields.io/badge/Visual%20Studio%20Code-007ACC?style=for-the-badge&logo=vscode&logoColor=white) <img src="https://img.shields.io/badge/pycharm-%23000000?style=for-the-badge&logo=pycharm&logoColor=white"/>

### MachingLearing
<img src="https://img.shields.io/badge/fastapi-%23009688?style=for-the-badge&logo=fastapi&logoColor=white"/> <img src="https://img.shields.io/badge/scikitlearn-%23F7931E?style=for-the-badge&logo=scikitlearn&logoColor=white"/>

### Infrastructure
<img src="https://img.shields.io/badge/docker-%232496ED?style=for-the-badge&logo=docker&logoColor=white"/> <img src="https://img.shields.io/badge/redis-%23FF4438?style=for-the-badge&logo=redis&logoColor=white"/> ![MySQL](https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white) ![Graphviz](https://img.shields.io/badge/Graphviz-used-blue.svg) ![AWS](https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=amazon-aws&logoColor=white)

# 12. í…ŒìŠ¤íŠ¸ ë³´ê³ ì„œ (CI í…ŒìŠ¤íŠ¸ ê²°ê³¼)
Front CI í…ŒìŠ¤íŠ¸ ê²°ê³¼

![image1](https://github.com/user-attachments/assets/3148084b-c313-4f5c-8a24-4c2ec0a0e8d7)
*********
![image2](https://github.com/user-attachments/assets/c955dd4c-fee1-429a-a161-ea3a10cf519d)
*********
![image3-1](https://github.com/user-attachments/assets/19d4676e-1e6d-49aa-bfde-9e76fb2ecbbb)
*********
![image3-2](https://github.com/user-attachments/assets/0fc14c05-4705-466b-ba03-5c4830ebc903)
*********
![image3-3](https://github.com/user-attachments/assets/4b2dfe05-2bfe-43c8-8777-9dded01c055c)
*********
![image4](https://github.com/user-attachments/assets/c88d74c5-aee2-4138-939c-352406ecf34c)

Frontend CI ì „ì²´ ê³¼ì •ì„ ë³´ë‹ˆ ì˜ ëŒì•„ ê°€ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

![backimg1](https://github.com/user-attachments/assets/95fc625a-d9e0-4512-a13c-29239fea7e72)
*********
![backimg2](https://github.com/user-attachments/assets/f965d3a8-df06-4f23-808f-390752ed6d63)
*********
![backimg3](https://github.com/user-attachments/assets/f33c81cd-ed22-48bb-a8ff-3e37f54e56ca)
*********
![backimg4](https://github.com/user-attachments/assets/eea06a75-8fe4-40c9-aa9d-49b4c46c4098)
*********

ë˜í•œ Backend CI ì „ì²´ ê³¼ì •ì„ ë³´ë‹ˆ ì˜ ëŒì•„ ê°€ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

# 13. Deploy Issue (ë°°í¬ ì´ìŠˆ)

## ìš°ì„  ìˆœìœ„ë¥¼ 5 ë‹¨ê³„ë¡œ ë‚˜ëˆ ì„œ ê´€ë¦¬  

```c
ì‹¤ì œ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•œë‹¤ëŠ” ë§ˆì¸ë“œë¡œ í˜„ì‹¤ ìƒí™©ì—ì„œ ë°œìƒí•˜ëŠ” í¬ê³  ì‘ì€ ì´ìŠˆë“¤ì´ ì¡´ì¬í•  ê²ƒì…ë‹ˆë‹¤.
ì´ ì„œë¹„ìŠ¤ë“¤ì—ì„œ íšŒì‚¬ ì…ì¥ì—ì„œ ë§¤ì¶œì— ì¤‘ìš”í•œ ê²ƒê³¼ ì¤‘ìš”í•˜ì§€ ì•Šì€ ê²ƒë“¤ì´ ìˆì„ ê²ƒì…ë‹ˆë‹¤.
ì´ì™€ ê°™ì€ ì‚¬í•­ë“¤ì„ ì‹¤ì§ˆì ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬ ì´ìŠˆ ê´€ë¦¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
```
  
### ê¸‰í•˜ì§€ì•ŠìŒ
* ì„œë¹„ìŠ¤ê°€ ê°€ëŠ¥í•˜ë©´ì„œ ì‚¬ìš©ìë“¤ì€ ë¶ˆí¸í•¨ì„ ëŠë¼ì§€ ëª»í•˜ì—¬ ë§¤ì¶œì— ì§€ì¥ì´ ì „í˜€ ì—†ëŠ” ê²½ìš°  
    ![issue1](https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-2nd-5Team/assets/126551524/464a12d6-26d4-4e2c-921f-f9ed95290370)
### ë³´í†µ
* ì„œë¹„ìŠ¤ê°€ ë¶ˆê°€ëŠ¥í•˜ì—¬ ê¸°ëŠ¥ì„ í•˜ì§€ ëª»í•˜ì§€ë§Œ ìˆ˜ì •í•˜ê¸° ì–´ë µì§€ ì•Šì€ ê²½ìš°
    ![issue2](https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-2nd-5Team/assets/126551524/606ce865-0868-4693-9ec4-1f8b04ca2fd8)
### ê¸‰í•¨
* ê°œë°œ ë§‰ë°”ì§€, ì„œë¹„ìŠ¤ ë°°í¬ ì§ì „ì— ë¬¸ì œê°€ ìƒê²¨ì„œ ê¸°ëŠ¥ì„ í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°
   ![issue3](https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-2nd-5Team/assets/126551524/a134df1b-49f3-4e20-810a-8e1db446ee91)
### ë§¤ìš° ê¸‰í•¨
* ê°œë°œ ì´ˆë°˜ë¶€í„° ë¬¸ì œê°€ ìƒê²¨ ì´í›„ ì—°ê´€ëœ ëª¨ë“  ê°œë°œ ì§„í–‰ì— ì°¨ì§ˆì´ ìƒê¸°ëŠ” ê²½ìš°
    ![issue4](https://github.com/SKNETWORKS-FAMILY-AICAMP/SKN01-2nd-5Team/assets/126551524/27b56023-cc2c-4905-84b7-8b0e34e2710a)



## Github Action ISSUE
build ìœ„ì¹˜ê°€ ì˜ëª»ë˜ì–´ ë°œìƒí•œ ì´ìŠˆ
<img src="https://github.com/user-attachments/assets/fc7861a4-0028-422f-bb57-5debeec19482"/>



ì •í™•í•œ ìœ„ì¹˜ì—ì„œ buildë¥¼ í•˜ê¸° ìœ„í•´ í”„ë¡œì íŠ¸ ì €ì¥ì†Œ ì´ë™

wait-for-it.shê°€ ìˆëŠ” ì €ì¥ì†Œê¹Œì§€ ê°€ê³  ê¶Œí•œì„ ë¶€ì—¬

```
chmod +x wait-for-it.sh
chmod +x manage.py
```
docker githubì— ì ‘ì†
```
echo <í† í°> | docker login ghcr.io -u <ìœ ì € ì´ë¦„> --password-stdin
```
buildë¥¼ ì§„í–‰
```
docker buildx build --platform linux/arm64 -f Dockerfile -t ghcr.io/<ìœ ì € ì´ë¦„>/<ì„œë²„ ì´ë¦„>:latest --push .
```
awskeyê°€ ìˆëŠ” ë¡œì»¬ë¡œ ë“¤ì–´ê°€ì„œ awsë¡œê·¸ì¸
```
ssh -i "í¨í‚¤íŒŒì¼ì´ë¦„.pem" ec2-user@ë‚´IP(í¼ë¸”ë¦­IPv4 ì£¼ì†Œ)
```
ì´ë¯¸ì§€ ì‚­ì œ
```
docker rmi -f $(docker images -aq)

docker ps
```
ì´í›„ 

ë¡œê·¸ì¸ í•œ ê³„ì •ì— ìˆëŠ” registryì— ìˆëŠ” buildëœ íŒŒì¼ì„ ê°€ì ¸ì™€ build

```
docker-compose build

docker-compose up
```


# 14. í•œ ì¤„ íšŒê³ 
- #### ê¹€ìš©í˜„ 
> ì§§ì€ ê¸°ê°„ì´ì˜€ì§€ë§Œ CI/CDê°€ ì •í™•íˆ ë¬´ì—‡ì´ê³  ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ë°°ì› ê³  ì‹¤ì œ ì›¹ì´ë‚˜ ì–´í”Œì´ ì–´ë–»ê²Œ ì‹œìŠ¤í…œì„ ë°°í¬í•˜ëŠ”ì§€ ë°°ìš°ê²Œ ë˜ì—ˆë‹¤.ë˜í•œ github actionì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë°°ìš°ë©´ì„œ ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ì„œ ì˜ ì‚¬ìš©í•´ì•¼ê² ë‹¤.
- #### ê¹€ì§€ë¯¼
>  ì§§ì€ ê¸°ê°„ë™ì•ˆ ë§ì€ ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„í•˜ë ¤ê³  í•˜ë‹¤ë³´ë‹ˆ ì‰½ì§„ ì•Šì•˜ì§€ë§Œ ê·¸ë˜ë„ í˜ë“ ë§Œí¼ ì„±ì¥í•˜ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•´ì„œ ì„±ê³µì ìœ¼ë¡œ ë§ˆë¬´ë¦¬í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
- #### í•œë³‘ì°¬ 
> aws ë°°í¬ë¥¼ í•˜ë©° ì ì  ì„±ì¥í•´ê°€ëŠ” ëŠë‚Œì´ ë“¤ì—ˆë‹¤.
- #### ì´ìš©ìš°
> ê·¸ë™ì•ˆ ìˆ˜ì—…ì„ í†µí•´ ë°°ìš´ ë¶€ë¶„ì„ ì§ì ‘ êµ¬í˜„ì„ í•˜ëŠ” ê²½í—˜ì„ í†µí•´ ë³´ë‹¤ ì˜ ì´í•´í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤
- #### ì •ì›í˜•
> CI/CD êµ¬ì¶•í•˜ë©´ì„œ AWSì™€ Dockerë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìë™ìœ¼ë¡œ ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ë°°í¬í•˜ëŠ” ê³¼ì •ì„ ì´í•´í•  ìˆ˜ ìˆì—ˆë‹¤.



